<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Switch-like UI</title>
<style>
html,body{
  margin:0;
  background:#000;
  overflow:hidden;
}
canvas{display:block}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
/* ===== 基本設定 ===== */
const c=document.getElementById("c");
const ctx=c.getContext("2d");
function resize(){
  c.width=innerWidth;
  c.height=innerHeight;
}
addEventListener("resize",resize);
resize();

/* ===== アプリ定義 ===== */
const apps=[
  {name:"GAME",type:"game",color:"#ff4d4d"},
  {name:"SETTINGS",type:"settings",color:"#4dd2ff"},
  {name:"ALBUM",type:"dummy",color:"#aaa"},
  {name:"POWER",type:"dummy",color:"#6aff6a"},
];

let selected=0;
let state="home";
let fade=0;
let zoom=1;

/* ===== 背景 ===== */
function drawBackground(){
  const g=ctx.createLinearGradient(0,0,0,c.height);
  g.addColorStop(0,"#111");
  g.addColorStop(1,"#000");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,c.width,c.height);
}

/* ===== アイコン描画 ===== */
function drawIcon(x,y,size,color,label,scale){
  ctx.save();
  ctx.translate(x,y);
  ctx.scale(scale,scale);
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.roundRect(-size/2,-size/2,size,size,20);
  ctx.fill();

  ctx.fillStyle="#fff";
  ctx.font="bold 16px sans-serif";
  ctx.textAlign="center";
  ctx.fillText(label,0,size/2+26);
  ctx.restore();
}

/* ===== HOME ===== */
function drawHome(){
  drawBackground();
  const spacing=160;
  const startX=c.width/2 - spacing*(apps.length-1)/2;

  apps.forEach((a,i)=>{
    const target=i===selected?1.25:1;
    a.scale ??=1;
    a.scale+= (target-a.scale)*0.15;
    drawIcon(
      startX+i*spacing,
      c.height/2,
      90,
      a.color,
      a.name,
      a.scale
    );
  });
}

/* ===== 起動中 ===== */
function drawLaunching(){
  drawBackground();
  zoom+=0.05;
  fade+=0.04;
  drawIcon(
    c.width/2,
    c.height/2,
    100,
    apps[selected].color,
    apps[selected].name,
    zoom
  );
  ctx.fillStyle=`rgba(0,0,0,${fade})`;
  ctx.fillRect(0,0,c.width,c.height);
  if(fade>=1){
    if(apps[selected].type==="game") state="game";
    else if(apps[selected].type==="settings") state="settings";
    else state="home";
    fade=0; zoom=1;
  }
}

/* ===== 設定画面 ===== */
function drawSettings(){
  drawBackground();
  ctx.fillStyle="#fff";
  ctx.font="28px sans-serif";
  ctx.textAlign="center";
  ctx.fillText("SETTINGS",c.width/2,120);
  ctx.font="18px sans-serif";
  ctx.fillText("Esc で HOME に戻る",c.width/2,170);
}

/* ===== ミニゲーム（サブ） ===== */
let px=0;
function drawGame(){
  drawBackground();
  px+=4;
  ctx.fillStyle="#0ff";
  ctx.fillRect(px%(c.width+50)-50,c.height/2,50,20);

  ctx.fillStyle="#fff";
  ctx.font="18px sans-serif";
  ctx.textAlign="center";
  ctx.fillText("GAME (サブ)",c.width/2,80);
  ctx.fillText("EscでHOMEに戻る",c.width/2,110);
}

/* ===== 戻り演出 ===== */
function drawReturning(){
  fade+=0.05;
  drawBackground();
  ctx.fillStyle=`rgba(0,0,0,${fade})`;
  ctx.fillRect(0,0,c.width,c.height);
  if(fade>=1){
    state="home";
    fade=0;
  }
}

/* ===== メインループ ===== */
function loop(){
  if(state==="home") drawHome();
  else if(state==="launching") drawLaunching();
  else if(state==="settings") drawSettings();
  else if(state==="game") drawGame();
  else if(state==="returning") drawReturning();
  requestAnimationFrame(loop);
}
loop();

/* ===== 操作 ===== */
addEventListener("keydown",e=>{
  if(state==="home"){
    if(e.key==="ArrowRight") selected=(selected+1)%apps.length;
    if(e.key==="ArrowLeft") selected=(selected-1+apps.length)%apps.length;
    if(e.key==="Enter") state="launching";
  }else{
    if(e.key==="Escape") state="returning";
  }
});
</script>
</body>
</html>
