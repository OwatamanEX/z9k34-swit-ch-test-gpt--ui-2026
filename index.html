<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Switch UI + Game</title>
<style>
html,body{margin:0;background:#000;overflow:hidden}
canvas{display:block}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
/* =====================
  基本
===================== */
const c=document.getElementById("c");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
addEventListener("resize",resize);resize();

/* =====================
  UI設定
===================== */
const settings={uiSpeed:0.15};

/* =====================
  アプリ
===================== */
const apps=[
  {name:"GAME",type:"game",color:"#ff5a5a"},
  {name:"SETTINGS",type:"settings",color:"#5ac8ff"},
  {name:"ALBUM",type:"dummy",color:"#aaa"},
  {name:"POWER",type:"dummy",color:"#6aff6a"},
];

let state="home",selected=0,fade=0,zoom=1;

/* =====================
  共通背景
===================== */
function bg(){
  const g=ctx.createLinearGradient(0,0,0,c.height);
  g.addColorStop(0,"#111");
  g.addColorStop(1,"#000");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,c.width,c.height);
}

/* =====================
  アイコン
===================== */
function icon(x,y,size,color,label,scale,active){
  ctx.save();
  ctx.translate(x,y);
  ctx.scale(scale,scale);
  ctx.shadowColor=active?color:"transparent";
  ctx.shadowBlur=active?30:0;

  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.roundRect(-size/2,-size/2,size,size,28);
  ctx.fill();

  const g=ctx.createLinearGradient(0,-size/2,0,size/2);
  g.addColorStop(0,"rgba(255,255,255,.4)");
  g.addColorStop(1,"rgba(255,255,255,0)");
  ctx.fillStyle=g;
  ctx.fill();

  ctx.restore();

  if(active){
    ctx.fillStyle="#fff";
    ctx.font="18px sans-serif";
    ctx.textAlign="center";
    ctx.fillText(label,x,y+size/2+30);
  }
}

/* =====================
  HOME
===================== */
function drawHome(){
  bg();
  const spacing=170;
  const sx=c.width/2-spacing*(apps.length-1)/2;
  apps.forEach((a,i)=>{
    a.scale ??=1;
    const t=i===selected?1.3:1;
    a.scale+=(t-a.scale)*settings.uiSpeed;
    icon(sx+i*spacing,c.height/2,96,a.color,a.name,a.scale,i===selected);
  });
}

/* =====================
  起動演出
===================== */
function drawLaunching(){
  bg();
  zoom+=0.06;
  fade+=0.05;
  icon(c.width/2,c.height/2,100,apps[selected].color,apps[selected].name,zoom,true);
  ctx.fillStyle=`rgba(0,0,0,${fade})`;
  ctx.fillRect(0,0,c.width,c.height);
  if(fade>=1){
    state=apps[selected].type;
    zoom=1;fade=0;
    if(state==="game") initGame();
  }
}

/* =====================
  SETTINGS
===================== */
function drawSettings(){
  bg();
  ctx.fillStyle="#fff";
  ctx.font="28px sans-serif";
  ctx.textAlign="center";
  ctx.fillText("SETTINGS",c.width/2,100);
  ctx.font="18px sans-serif";
  ctx.fillText("EscでHOMEに戻る",c.width/2,150);
}

/* =====================
  GAME 本格化
===================== */
let player,bullets,score,frame,slow=false;

function initGame(){
  player={x:c.width/2,y:c.height-80,vx:0};
  bullets=[];
  score=0;
  frame=0;
}

function drawGame(){
  bg();
  frame++;
  score++;

  /* 自機 */
  player.vx*=0.85;
  player.x+=player.vx;
  player.x=Math.max(20,Math.min(c.width-20,player.x));

  ctx.fillStyle="#0ff";
  ctx.beginPath();
  ctx.moveTo(player.x,player.y-16);
  ctx.lineTo(player.x-12,player.y+12);
  ctx.lineTo(player.x+12,player.y+12);
  ctx.closePath();
  ctx.fill();

  /* 弾幕生成 */
  if(frame%Math.max(6,20-frame/300)==0){
    const cx=Math.random()*c.width;
    for(let i=0;i<6;i++){
      bullets.push({
        x:cx,y:-10,
        vx:Math.sin(i)*1.2,
        vy:2+frame/600
      });
    }
  }

  /* 弾描画 */
  ctx.fillStyle="#ff4d4d";
  bullets.forEach(b=>{
    b.x+=b.vx;
    b.y+=b.vy;
    ctx.beginPath();
    ctx.arc(b.x,b.y,4,0,Math.PI*2);
    ctx.fill();
  });
  bullets=bullets.filter(b=>b.y<c.height+20);

  /* UI */
  ctx.fillStyle="#fff";
  ctx.font="16px monospace";
  ctx.textAlign="left";
  ctx.fillText("SCORE "+score,20,30);
  ctx.textAlign="center";
  ctx.fillText("EscでHOME",c.width/2,30);
}

/* =====================
  戻る
===================== */
function drawReturn(){
  fade+=0.06;
  bg();
  ctx.fillStyle=`rgba(0,0,0,${fade})`;
  ctx.fillRect(0,0,c.width,c.height);
  if(fade>=1){state="home";fade=0}
}

/* =====================
  ループ
===================== */
function loop(){
  if(state==="home")drawHome();
  else if(state==="launching")drawLaunching();
  else if(state==="settings")drawSettings();
  else if(state==="game")drawGame();
  else if(state==="return")drawReturn();
  requestAnimationFrame(loop);
}
loop();

/* =====================
  入力
===================== */
addEventListener("keydown",e=>{
  if(state==="home"){
    if(e.key==="ArrowRight")selected=(selected+1)%apps.length;
    if(e.key==="ArrowLeft")selected=(selected-1+apps.length)%apps.length;
    if(e.key==="Enter")state="launching";
  }else if(state==="game"){
    if(e.key==="ArrowLeft")player.vx-=slow?0.4:0.8;
    if(e.key==="ArrowRight")player.vx+=slow?0.4:0.8;
    if(e.key==="Shift")slow=true;
    if(e.key==="Escape")state="return";
  }else{
    if(e.key==="Escape")state="return";
  }
});
addEventListener("keyup",e=>{
  if(e.key==="Shift")slow=false;
});
</script>
</body>
</html>
