<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Switch UI Main</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
html,body{margin:0;width:100%;height:100%;background:#000;overflow:hidden;}
canvas{display:block;}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
/* ================= 基本 ================= */
const c=document.getElementById("c");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight;}
addEventListener("resize",resize);resize();

const keys={};
addEventListener("keydown",e=>keys[e.key]=true);
addEventListener("keyup",e=>keys[e.key]=false);

let state="home"; // home | game

/* ================= 背景 ================= */
const stars=[];
for(let i=0;i<150;i++){
  stars.push({x:Math.random()*c.width,y:Math.random()*c.height,s:Math.random()*2+1});
}
function drawStars(speed){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,c.width,c.height);
  ctx.fillStyle="#fff";
  for(const st of stars){
    st.y+=st.s*speed;
    if(st.y>c.height){st.y=0;st.x=Math.random()*c.width;}
    ctx.fillRect(st.x,st.y,st.s,st.s);
  }
}

/* ================= UIアイコン ================= */
function makeIcon(color){
  const cv=document.createElement("canvas");
  cv.width=cv.height=160;
  const x=cv.getContext("2d");
  const g=x.createLinearGradient(0,0,160,160);
  g.addColorStop(0,color);
  g.addColorStop(1,"#000");
  x.fillStyle=g;
  x.fillRect(0,0,160,160);
  return cv;
}

const apps=[
  {name:"ゲーム",icon:makeIcon("#ff5f5f"),type:"game"},
  {name:"設定",icon:makeIcon("#5f7cff")},
  {name:"アルバム",icon:makeIcon("#ffc96a")}
];

let selected=0;
let pos=0,vel=0;
const spacing=220;

/* ================= HOME UI ================= */
function drawHome(){
  drawStars(0.4);
  const cx=c.width/2,cy=c.height/2;
  const target=selected*spacing;
  vel+=(target-pos)*0.12;
  vel*=0.75;
  pos+=vel;

  for(let i=0;i<apps.length;i++){
    const x=cx+i*spacing-pos;
    const d=Math.abs(i*spacing-pos)/spacing;
    const s=Math.max(0.8,1.4-d*0.4);

    ctx.save();
    ctx.translate(x,cy);
    ctx.scale(s,s);
    if(i===selected){
      ctx.shadowColor="#0ff";
      ctx.shadowBlur=25;
    }
    ctx.drawImage(apps[i].icon,-80,-80,160,160);
    ctx.restore();

    if(i===selected){
      ctx.fillStyle="#fff";
      ctx.font="24px sans-serif";
      ctx.textAlign="center";
      ctx.fillText(apps[i].name,x,cy+140);
    }
  }
}

/* ================= ゲーム（サブ） ================= */
let px,py,vx,vy;
function startGame(){
  px=c.width/2;
  py=c.height*0.8;
  vx=vy=0;
}
function drawGame(){
  drawStars(1.2);

  const a=0.6;
  if(keys.ArrowLeft)vx-=a;
  if(keys.ArrowRight)vx+=a;
  if(keys.ArrowUp)vy-=a;
  if(keys.ArrowDown)vy+=a;
  vx*=0.9;vy*=0.9;
  px+=vx;py+=vy;

  ctx.fillStyle="#0ff";
  ctx.beginPath();
  ctx.moveTo(px,py-15);
  ctx.lineTo(px+10,py+10);
  ctx.lineTo(px-10,py+10);
  ctx.closePath();
  ctx.fill();

  ctx.fillStyle="#fff";
  ctx.font="18px sans-serif";
  ctx.textAlign="center";
  ctx.fillText("EscでHOMEに戻る",c.width/2,40);
}

/* ================= ループ ================= */
function loop(){
  if(state==="home") drawHome();
  if(state==="game") drawGame();
  requestAnimationFrame(loop);
}
loop();

/* ================= 操作 ================= */
addEventListener("keydown",e=>{
  if(state==="home"){
    if(e.key==="ArrowRight")selected=(selected+1)%apps.length;
    if(e.key==="ArrowLeft")selected=(selected-1+apps.length)%apps.length;
    if(e.key==="Enter"){
      if(apps[selected].type==="game"){
        startGame();
        state="game";
      }
    }
  }else if(state==="game" && e.key==="Escape"){
    state="home";
  }
});
</script>
</body>
</html>
