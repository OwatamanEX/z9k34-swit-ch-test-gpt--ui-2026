<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Switch UI + STG</title>
<style>
html,body{margin:0;background:#000;overflow:hidden}
canvas{display:block}
</style>
</head>
<body>
<canvas id="c"></canvas>
<script>
/* ========= 基本 ========= */
const c=document.getElementById("c");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
addEventListener("resize",resize);resize();

/* ========= UI ========= */
const apps=[
  {name:"GAME",type:"game",color:"#ff5a5a"},
  {name:"SETTINGS",type:"settings",color:"#5ac8ff"},
  {name:"ALBUM",type:"dummy",color:"#aaa"},
  {name:"POWER",type:"dummy",color:"#6aff6a"},
];
let state="home",selected=0,fade=0,zoom=1;

/* ========= 背景 ========= */
let stars=[];
function initStars(){
  stars=[];
  for(let i=0;i<120;i++){
    stars.push({
      x:Math.random()*c.width,
      y:Math.random()*c.height,
      s:Math.random()*2+1
    });
  }
}
function drawStars(speed){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,c.width,c.height);
  ctx.fillStyle="#888";
  stars.forEach(st=>{
    st.y+=speed*st.s;
    if(st.y>c.height){st.y=0;st.x=Math.random()*c.width}
    ctx.fillRect(st.x,st.y,st.s,st.s);
  });
}

/* ========= アイコン ========= */
function icon(x,y,size,color,label,scale,active){
  ctx.save();
  ctx.translate(x,y);
  ctx.scale(scale,scale);
  ctx.shadowColor=active?color:"transparent";
  ctx.shadowBlur=active?30:0;
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.roundRect(-size/2,-size/2,size,size,28);
  ctx.fill();
  ctx.restore();
  if(active){
    ctx.fillStyle="#fff";
    ctx.font="18px sans-serif";
    ctx.textAlign="center";
    ctx.fillText(label,x,y+size/2+30);
  }
}

/* ========= HOME ========= */
function drawHome(){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,c.width,c.height);
  const sp=170;
  const sx=c.width/2-sp*(apps.length-1)/2;
  apps.forEach((a,i)=>{
    a.scale ??=1;
    const t=i===selected?1.3:1;
    a.scale+=(t-a.scale)*0.15;
    icon(sx+i*sp,c.height/2,96,a.color,a.name,a.scale,i===selected);
  });
}

/* ========= 起動 ========= */
function drawLaunching(){
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,c.width,c.height);
  zoom+=0.06; fade+=0.05;
  icon(c.width/2,c.height/2,100,apps[selected].color,apps[selected].name,zoom,true);
  ctx.fillStyle=`rgba(0,0,0,${fade})`;
  ctx.fillRect(0,0,c.width,c.height);
  if(fade>=1){
    state=apps[selected].type;
    zoom=1;fade=0;
    if(state==="game") initGame();
  }
}

/* ========= GAME ========= */
let player,bullets,score,frame,slow,gameOver;

function initGame(){
  initStars();
  player={x:c.width/2,y:c.height-80,vx:0};
  bullets=[];
  score=0;
  frame=0;
  slow=false;
  gameOver=false;
}

function hitTest(b){
  const dx=b.x-player.x;
  const dy=b.y-player.y;
  return Math.sqrt(dx*dx+dy*dy)<6; // 極小判定
}

function drawGame(){
  frame++;
  score++;

  drawStars(1+frame/600);

  /* 自機 */
  player.vx*=0.85;
  player.x+=player.vx;
  player.x=Math.max(20,Math.min(c.width-20,player.x));

  ctx.fillStyle="#0ff";
  ctx.beginPath();
  ctx.moveTo(player.x,player.y-14);
  ctx.lineTo(player.x-10,player.y+10);
  ctx.lineTo(player.x+10,player.y+10);
  ctx.closePath();
  ctx.fill();

  /* 弾生成 */
  if(frame%Math.max(6,22-frame/400)==0){
    const cx=Math.random()*c.width;
    for(let i=0;i<8;i++){
      bullets.push({
        x:cx,y:-10,
        vx:Math.cos(i)*1.2,
        vy:2+frame/700
      });
    }
  }

  /* 弾描画 */
  ctx.fillStyle="#ff4d4d";
  bullets.forEach(b=>{
    b.x+=b.vx;
    b.y+=b.vy;
    ctx.beginPath();
    ctx.arc(b.x,b.y,4,0,Math.PI*2);
    ctx.fill();
    if(!gameOver && hitTest(b)) gameOver=true;
  });
  bullets=bullets.filter(b=>b.y<c.height+20);

  /* UI */
  ctx.fillStyle="#fff";
  ctx.font="16px monospace";
  ctx.textAlign="left";
  ctx.fillText("SCORE "+score,20,30);

  if(gameOver){
    ctx.fillStyle="rgba(0,0,0,0.6)";
    ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle="#fff";
    ctx.font="32px sans-serif";
    ctx.textAlign="center";
    ctx.fillText("GAME OVER",c.width/2,c.height/2-20);
    ctx.font="18px sans-serif";
    ctx.fillText("Enter : Retry",c.width/2,c.height/2+20);
    ctx.fillText("Esc : HOME",c.width/2,c.height/2+50);
  }
}

/* ========= 戻る ========= */
function drawReturn(){
  fade+=0.06;
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,c.width,c.height);
  ctx.fillStyle=`rgba(0,0,0,${fade})`;
  ctx.fillRect(0,0,c.width,c.height);
  if(fade>=1){state="home";fade=0}
}

/* ========= ループ ========= */
function loop(){
  if(state==="home")drawHome();
  else if(state==="launching")drawLaunching();
  else if(state==="game")drawGame();
  else if(state==="return")drawReturn();
  requestAnimationFrame(loop);
}
loop();

/* ========= 入力 ========= */
addEventListener("keydown",e=>{
  if(state==="home"){
    if(e.key==="ArrowRight")selected=(selected+1)%apps.length;
    if(e.key==="ArrowLeft")selected=(selected-1+apps.length)%apps.length;
    if(e.key==="Enter")state="launching";
  }else if(state==="game"){
    if(!gameOver){
      if(e.key==="ArrowLeft")player.vx-=slow?0.4:0.8;
      if(e.key==="ArrowRight")player.vx+=slow?0.4:0.8;
      if(e.key==="Shift")slow=true;
    }else{
      if(e.key==="Enter") initGame();
    }
    if(e.key==="Escape")state="return";
  }
});
addEventListener("keyup",e=>{
  if(e.key==="Shift")slow=false;
});
</script>
</body>
</html>
