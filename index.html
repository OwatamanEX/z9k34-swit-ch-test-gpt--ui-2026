<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Switch UI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#000000">

<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" href="favicon.png">

<style>
html,body{margin:0;width:100%;height:100%;background:#000;overflow:hidden;}
canvas{display:block;}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
// Canvas 設定
const c=document.getElementById("c");
const ctx=c.getContext("2d");
const buffer=document.createElement("canvas");
const bctx=buffer.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight;buffer.width=c.width;buffer.height=c.height;}
window.addEventListener("resize",resize); resize();

function easeOutCubic(t){return 1-Math.pow(1-t,3);}

// --- アイコン ---
function baseIcon(c1,c2){
  const cv=document.createElement("canvas");
  cv.width=cv.height=160;
  const x=cv.getContext("2d");
  const g=x.createLinearGradient(0,0,160,160);
  g.addColorStop(0,c1); g.addColorStop(1,c2);
  x.fillStyle=g; x.fillRect(0,0,160,160);
  return {cv,x};
}
function iconGame(){const{cv,x}=baseIcon("#ff6a6a","#d93030");x.fillStyle="#fff";x.beginPath();x.moveTo(60,45);x.lineTo(115,80);x.lineTo(60,115);x.fill();return cv;}
function iconSettings(){const{cv,x}=baseIcon("#5f7cff","#2f45d9");x.strokeStyle="#fff";x.lineWidth=10;x.beginPath();x.arc(80,80,28,0,Math.PI*2);x.stroke();for(let i=0;i<6;i++){const a=i*Math.PI/3;x.beginPath();x.moveTo(80+Math.cos(a)*36,80+Math.sin(a)*36);x.lineTo(80+Math.cos(a)*52,80+Math.sin(a)*52);x.stroke();}return cv;}
function iconAlbum(){const{cv,x}=baseIcon("#ffc96a","#e6a12a");x.fillStyle="#fff";x.fillRect(40,45,80,55);return cv;}
function iconPower(){const{cv,x}=baseIcon("#aaa","#666");x.strokeStyle="#fff";x.lineWidth=10;x.beginPath();x.arc(80,90,30,Math.PI*0.25,Math.PI*0.75);x.stroke();x.beginPath();x.moveTo(80,30);x.lineTo(80,60);x.stroke();return cv;}

const apps=[
{name:"ゲーム",icon:iconGame()},
{name:"設定",icon:iconSettings()},
{name:"アルバム",icon:iconAlbum()},
{name:"電源",icon:iconPower()}
];

// --- 状態 ---
let state="home";
let selected=0,pos=0,vel=0,zoom=1,fade=0,timer=0;
let spin=0,spinSpeed=0;
const spacing=220;

// --- 描画 ---
function drawHome(t){
  const cx=c.width/2,cy=c.height/2;
  const tp=selected*spacing;
  vel=(vel+(tp-pos)*0.12)*0.75; pos+=vel;

  for(let i=0;i<apps.length;i++){
    const x=cx+i*spacing-pos;
    const d=Math.abs(i*spacing-pos)/spacing;
    let s=Math.max(0.8,1.35-d*0.35);

    // 選択中アイコン拡大
    if(i===selected && (state==="home"||state==="returning"||state==="launching")) s*=1.2;

    t.save(); t.translate(x,cy); t.scale(s,s);

    // 選択中の光
    if(i===selected){t.shadowColor="#0ff"; t.shadowBlur=30;}

    t.drawImage(apps[i].icon,-80,-80,160,160); t.restore();

    // 名前表示
    if(i===selected){t.fillStyle="#fff"; t.font="24px sans-serif"; t.textAlign="center"; t.fillText(apps[i].name,x,cy+140);}
  }
}

function drawLoading(){
  bctx.clearRect(0,0,c.width,c.height); drawHome(bctx);
  ctx.filter="blur(12px)"; ctx.drawImage(buffer,0,0); ctx.filter="none";
  ctx.fillStyle="rgba(0,0,0,0.35)"; ctx.fillRect(0,0,c.width,c.height);

  ctx.fillStyle="#fff"; ctx.font="28px sans-serif"; ctx.textAlign="center";
  ctx.fillText(apps[selected].name+" を起動しています",c.width/2,c.height/2-80);

  // 回転ドット
  const cx=c.width/2,cy=c.height/2,R=32,r=5,N=8;
  spinSpeed+=(0.08-spinSpeed)*0.08; spin+=spinSpeed;
  for(let i=0;i<N;i++){
    const a=spin+i*(Math.PI*2/N);
    ctx.globalAlpha=0.3+(i/N)*0.7;
    ctx.beginPath(); ctx.arc(cx+Math.cos(a)*R,cy+Math.sin(a)*R,r,0,Math.PI*2); ctx.fill();
  }
  ctx.globalAlpha=1;
}

function drawApp(){
  ctx.fillStyle="#111"; ctx.fillRect(0,0,c.width,c.height);
  ctx.fillStyle="#fff"; ctx.font="48px sans-serif"; ctx.textAlign="center";
  ctx.fillText(apps[selected].name,c.width/2,c.height/2);
  ctx.font="20px sans-serif"; ctx.fillText("EscでHOMEに戻る",c.width/2,c.height/2+60);
}

// --- メインループ ---
function loop(){
  ctx.clearRect(0,0,c.width,c.height);

  if(state==="home") drawHome(ctx);

  if(state==="launching"){ 
    drawHome(ctx);
    zoom+=0.05; fade+=0.05;
    ctx.fillStyle=`rgba(0,0,0,${fade})`; ctx.fillRect(0,0,c.width,c.height);
    if(fade>=1){state="loading"; timer=0; zoom=1; fade=0;}
  }

  if(state==="loading"){ drawLoading(); timer++; if(timer>90){state="app"; timer=0;} }

  if(state==="app") drawApp();

  if(state==="returning"){ 
    drawHome(ctx);
    timer++; const t=Math.min(timer/25,1); const e=easeOutCubic(t);
    zoom=1+(1.2-1)*(1-e); fade=1-e;
    ctx.fillStyle=`rgba(0,0,0,${fade})`; ctx.fillRect(0,0,c.width,c.height);
    if(t>=1){state="home"; zoom=1; fade=0; timer=0;}
  }

  requestAnimationFrame(loop);
}
loop();

// --- キー操作 ---
window.addEventListener("keydown",e=>{
  if(state==="home"){
    if(e.key==="ArrowRight") selected=(selected+1)%apps.length;
    if(e.key==="ArrowLeft") selected=(selected-1+apps.length)%apps.length;
    if(e.key==="Enter"){state="launching"; zoom=1; fade=0; timer=0;}
  }else if(state==="app" && e.key==="Escape"){
    state="returning"; timer=0;
  }
});
</script>
</body>
</html>
